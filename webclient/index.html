<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WhoisOnline Chat</title>

    <link rel="stylesheet" type="text/css" href="css/global.css">
    <link rel="stylesheet" type="text/css" href="css/conversations.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>
	function api(cmd,data,f)
	{
	    $.getJSON("/clientapi/"+cmd,data,function (data) {
		if (data.result==200) f(data);
			// else TODO
	    }); // .fail() TODO
	}

	function logout()
	{
	    api("logout",false,function () {
		window.location="/login";
	    });
	}

	function add_omenu_entry(word,func)
	{
	    var entry=$("<button class=menubutton>"+word+"</button>");
	    entry.appendTo("#omenu").click(func);
	}

	$(document).ready(function(){
	    api("start",false,function (data) {
		$(".username").text(data.username);
		if(data.now) last_poll=new Date(data.now);
		$(".now").text(last_poll.toLocaleTimeString());
	    });
	    $("#omenu").hide();
	    $(".option-menu").click(function () { $("#omenu").toggle(); });
	    $("#add_conv").click(function () {
		$("#add_conv").hide();
		$("#add_conv_dialog").show();
	    });
	    $("#close_search").click(function () {
		$("#add_conv").show();
		$("#add_conv_dialog").hide();
	    });
	    add_omenu_entry("Logout",logout);
	});
    </script>
</head>
<body>
<div id=header>
    <h1 class=logo>WhoisOnline</h1>
    <div id=status>
	<i class="option-menu fa fa-bars"></i>
	<div class=now></div>
	<div class=username></div>
    </div>
</div>
<div id=convlist_div>
    <i id=add_conv class="fa fa-plus-circle"></i>
    <div id=add_conv_dialog>
	<input id=searchword> 
	<i id="do_search" class="fa fa-search"></i>
	<i id="close_search" class="fa fa-times"></i>
    </div>
    <ul class=convlist>
	<li>Loading...<i class="fa fa-circle-o-notch fa-spin"></i></li>
    </ul>
</div>
<div id=conv_div>
    Select a conversation int the conversation list.
</div>
<div id=omenu>
</div>
</body>
</html>
